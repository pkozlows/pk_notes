Throughout, I am working in the retarded time formalism. We are working with a plane wave basis, where each state has its own wavevector.
\section{MF}
Even before doing HF, I generate my basis of plane waves, and their wave vectors in 3D are just a list of integers, three entries long. From HF, I get a set of MO coefficients $C_{\bm{k}_\mu \bm{k}_p}$ and orbital energies $\epsilon_{\bm{k}_p}$.
\section{RPA}
For the UEG, I am first looping over all momentum transfer vectors $\bm{k}_q$. To learn which excitations are valid for the given $\bm{k}_q$, we first loop over occupied states $\bm{k}_i$. Virtual states $\bm{k}_a$ are already determined by that point; we compute $\bm{k}_a \equiv \bm{k}_i + \bm{k}_q$, and based of of whether it is a valid virtual index, we either add it to our list or continue. The criterion for validity is that the wave vector must be outside the Fermi sphere, but still within our plane wave basis, i.e. within the KE cutoff. We do the same for the second pair of indices $\bm{k}_j, \bm{k}_b$. Then, we can form the Casida eigenproblem for each $\bm{k}_q$.
\begin{equation}
    \begin{pmatrix}
        \bm{A}(\bm{k}_q) & \bm{B}(\bm{k}_q) \\
        -\bm{B}(\bm{k}_q) & -\bm{A}(\bm{k}_q)
    \end{pmatrix}
    \begin{pmatrix}
        \bm{X}(\bm{k}_q) & \bm{Y}(\bm{k}_q) \\
        \bm{Y}(\bm{k}_q) & \bm{X}(\bm{k}_q)
    \end{pmatrix}
    \begin{pmatrix}
        \bm{\Omega}(\bm{k}_q) & \bm{0} \\
        \bm{0} & -\bm{\Omega}(\bm{k}_q)
    \end{pmatrix}
    = \begin{pmatrix}
        \bm{X}(\bm{k}_q) & \bm{Y}(\bm{k}_q) \\
        \bm{Y}(\bm{k}_q) & \bm{X}(\bm{k}_q)
    \end{pmatrix}
    \label{eqn:casida_eq}
\end{equation}
The $\bm{A}(\bm{k}_q)$ and $\bm{B}(\bm{k}_q)$ matrices are defined as
\begin{align}
    A_{\bm{k}_i \bm{k}_a,\, \bm{k}_b \bm{k}_j }(\bm{k}_q) &= \left(\epsilon_{\bm{k}_a}-\epsilon_{\bm{k}_i}\right) \delta_{\bm{k}_i \bm{k}_j} \delta_{\bm{k}_a \bm{k}_b} + \frac{4\pi}{|\bm{k}_q|^2} \\
    B_{\bm{k}_i \bm{k}_a,\, \bm{k}_j \bm{k}_b}(\bm{k}_q) &= \frac{4\pi}{|\bm{k}_q|^2}
\end{align}
After solving the Casida eigenvalue problem, I perform the bioorthogonalization procedure, which ensures that
\begin{equation}
    \left(\bm{X}(\bm{k}_q) - \bm{Y}(\bm{k}_q)\right)^\dagger \left(\bm{X}(\bm{k}_q) + \bm{Y}(\bm{k}_q)\right) = \bm{I}
    % \left(\bm{X} - \bm{Y}\right)^\dagger \left(\bm{X} + \bm{Y}\right) = \bm{I}
\end{equation}
Now, I have a list of excitation energies $\Omega$ and corresponding right eigenvectors $\bm{X}, \bm{Y}$ for each momentum transfer $\bm{k}_q$. But for the self energy, we actually need rather the transition densities $\rho(\bm{k}_q)$, which are lists (with length $\mu$) of scalars, defined as
\begin{equation}
    \rho_{\nu}(\bm{k}_q) = \sum_{\bm{k}_i \bm{k}_a} \left(X_{\bm{k}_i \bm{k}_a}^\nu(\bm{k}_q) + Y_{\bm{k}_i \bm{k}_a}^\nu(\bm{k}_q)\right).
\end{equation}
So to get them, I just need to contract over the indices $\bm{k}_i, \bm{k}_a$.
\subsubsection{Verification}
We can compute the RPA correlation energy via the plasmon formula:
\begin{align}
    E_c^{RPA} & = \frac{1}{2} \operatorname{Tr}(\sum_{\bm{q}} \bm{\Omega }(\bm{q}) -\bm{A}(\bm{q})) \\
\end{align}
and then we just have to divide by the number of electrons to get the correlation energy per electron.
\section{GW}

% Now, I can determine the transition densities $w_{\bm{k}_p \bm{k}_r}^\nu(\bm{k}_q)$. In the Ab-Initio case, these are given by
% \begin{equation}
%     w_{\bm{k}_p \bm{k}_r}^\nu = \sum_{\bm{k}_i \bm{k}_a} (X_{\bm{k}_i \bm{k}_a}^\nu + Y_{\bm{k}_i \bm{k}_a}^\nu) \langle \bm{k}_p \bm{k}_i || \bm{k}_r \bm{k}_a \rangle
% \end{equation}
% However, in the uniform electron gas (UEG) with a plane-wave basis, we have
% \begin{align}
%     w_{\bm{k}_p \bm{k}_r}^\nu(\bm{k}_q) &= 
%     \sum_{\bm{k}_i,\bm{k}_a} (X_{\bm{k}_i \bm{k}_a}^\nu(\bm{k}_q) + Y_{\bm{k}_i \bm{k}_a}^\nu(\bm{k}_q)) 
%     \frac{4\pi}{|\bm{k}_q|^2}
%     \left[\, \delta_{\bm{k}_p - \bm{k}_q, \bm{k}_r }
%     \, \delta_{\bm{k}_i - \bm{k}_q,\, \bm{k}_a}\right] \\
%  &= \frac{4\pi}{ |\bm{k}_q|^2} \delta_{\bm{k}_p - \bm{k}_q, \bm{k}_r } \sum_{\bm{k}_i} 
%     \bigl(X_{\bm{k}_i,\,\bm{k}_a}^\nu(\bm{k}_q) + Y_{\bm{k}_i,\,\bm{k}_a}^\nu(\bm{k}_q)\bigr)
% \end{align}
% % The direct term is always going to be 0, because we cannot have 
% The second Kronecker delta in the first line is redundant because we have already enforced that condition (I defined earlier that $\bm{k}_i - \bm{k}_q = \bm{k}_a$), but now we can see that the external indices $(\bm{k}_p,\bm{k}_r)$ must also differ by the same $\bm{k}_q$.

\subsection{Correlation self energy}
\subsubsection{Derivation from scratch}
We can start from the definition of the GW self energy, which is a convolution of the Green's function and the screened Coulomb interaction:
\begin{align}
    \Sigma(\mathbf{k}, \omega)&=\frac{i}{2 \pi} \int d \omega^{\prime} \frac{d^3 q}{(2 \pi)^3} G\left(\mathbf{k}-\mathbf{q}, \omega-\omega^{\prime}\right) W\left(\mathbf{q}, \omega^{\prime}\right)
\end{align}
 The screened Coulomb interaction in the RPA is given by 
\begin{align}
W(\mathbf{q}, \omega)&= v(\mathbf{q}) + v(\mathbf{q}) \chi_0(\mathbf{q}, \omega) v(\mathbf{q})  + \ldots \\
&= \frac{v(\mathbf{q})}{1-v(\mathbf{q}) \chi_0{(\mathbf{q}, \omega)}} \equiv \frac{v(\mathbf{q})}{\varepsilon(\mathbf{q}, \omega)}  \\
&= v(\mathbf{q}) + v^2(\mathbf{q}) \chi_{RPA}(\mathbf{q}, \omega)\\
\implies W_{p}(\mathbf{q}, \omega) \equiv W(\mathbf{q}, \omega) - v(\mathbf{q}) &= v^2(\mathbf{q}) \chi_{RPA}(\mathbf{q}, \omega) \\
&= \sum_{\nu} \frac{2 \omega_\nu v^2(\mathbf{q}) |\rho_\nu(\mathbf{q})|^2}{\omega^2 - \omega_\nu^2}
% &= \frac{v(\mathbf{q})}{1 - v(\mathbf{q}) \sum_{\bm{k}} \frac{f_{\bm{k}+\bm{q}}-f_{\bm{k}}}{\omega+\epsilon _{\bm{k}+q}-\epsilon _{\bm{k}}+i \eta}} \\
% &= \frac{v(\mathbf{q})}{1 - \frac{1}{2}v(\mathbf{q}) \sum_k\left(f_{k+q}-f_k\right)\left[\frac{1}{\omega+\Delta_{k, q}+i \eta}-\frac{1}{\omega-\Delta_{k, q}+i \eta}\right]  }\\
% &= \frac{v(\mathbf{q})}{1 - v(\mathbf{q}) \sum_k\left(f_{k+q}-f_k\right)\frac{\Delta_{k, q}}{(\omega+i \eta)^2-\Delta_{k, q}^2}}\\
\end{align}
where it can be shown that $\varepsilon^{-1}(\mathbf{q}, \omega) = 1 + v(\mathbf{q}) \chi_{RPA}(\mathbf{q}, \omega)$. At this point, we can just quote the final result of Hedin for a retarded self energy in the $GW$ approximation:
\begin{align}
\Sigma_{p o l}\left(x, x^{\prime} ; \omega\right)&=\sum_{i, s \neq 0} \frac{V^s(\boldsymbol{r}) V^s\left(\boldsymbol{r}^{\prime}\right) \phi_i(x) \phi_i^*\left(x^{\prime}\right)}{\omega+\omega_s \operatorname{sgn}\left(\mu-\varepsilon_i\right)-\varepsilon_i} \\
\implies
    \Sigma (\bm{k}, \omega) 
    &=\sum_{q, \nu} \frac{ v^2(\mathbf{q}) |\rho_\nu(\mathbf{q})|^2}{\omega + \Omega_\nu \operatorname{sgn}(\mu - \epsilon_{\bm{k}-\bm{q}}) - \epsilon_{\bm{k}-\bm{q}} + i \eta}
\end{align}
since we know that we will have a diagonal self energy in momentum space for the UEG. We defined
\begin{align}
    V^s(\mathbf{r}) \rightarrow V^\nu(\mathbf{q}) &= v(\mathbf{q}) \rho_\nu(\mathbf{q}) , \\
    \omega_s \rightarrow \Omega_\nu 
\end{align}
In relation to our Casida eigenproblem, we can identify that the excitation energies $\Omega_\nu$ are just the eigenvalues from Eqn. \ref{eqn:casida_eq}, and the transition densities $\rho_\nu(\bm{q})$ are given by
\begin{equation}
    \rho_{\nu}(\bm{q}) = \sum_{\bm{k}_i \bm{k}_a} (X_{\bm{k}_i \bm{k}_a}^\nu(\bm{q}) + Y_{\bm{k}_i \bm{k}_a}^\nu(\bm{q})).
\end{equation}
So the expression I find has one more factor of the ERI then the one I have written below.
\begin{equation}
    \Sigma^{\text{corr}}(\bm{k}_p,\omega) = \sum_{\bm{k}_q}\sum_{\nu }^{\text{RPA}} \frac{4\pi}{|\bm{k}_q|^2} |\rho_\nu(\bm{k}_q)|^2 \left[ \frac{f_{\bm{k}_p - \bm{k}_q}}{\omega + \Omega_\nu(\bm{k}_q) - \epsilon_{\bm{k}_p - \bm{k}_q} + i\eta} + \frac{1 - f_{\bm{k}_p - \bm{k}_q}}{\omega - \Omega_\nu(\bm{k}_q) - \epsilon_{\bm{k}_p - \bm{k}_q} + i\eta} \right]
\end{equation}
\subsection{Spectral function}
Finally, the spectral function is given by
\begin{equation}
    A(\bm{k}_p,\omega) = \frac{1}{\pi} \frac{|\text{Im}\,\Sigma(\bm{k}_p,\omega)|}{\left(\omega - \epsilon_{\bm{k}_p} - \text{Re}\,\Sigma(\bm{k}_p,\omega)\right)^2 + \left(\text{Im}\,\Sigma(\bm{k}_p,\omega)\right)^2}
\end{equation}
\section{GW+C}
\subsection{Cumulant}
 By relating the Dyson equation to the Taylor series expansion of the exponential (both to first order), we can write:
\begin{equation}
    \bm{G}^0(t) \bm{C}(t) = \iint \dd t_1 \dd t_2 \bm{G}^0(t-t_1) \bm{\Sigma}^c(t_1 - t_2) \bm{G}^0(t_2)
\end{equation}
We know that all of the operators are diagonal in momentum space for the UEG, so insertion of the resolution of the identity just gives us:
\begin{align}
\bm{G}^{0}(\bm{p}, t) \bm{C}(\bm{p}, t) &= {\iint \dd t_1 \dd t_2 \bm{G}^{0}(\bm{p}, t-t_1) \bm{\Sigma}^c(\bm{p}, t_1 - t_2) \bm{G}^{0}(\bm{p}, t_2)} \\
&= \int \frac{\dd \omega}{2\pi} e^{-i\omega t} \bm{G}^{0}(\bm{p},\omega)\bm{\Sigma}^c(\bm{p},\omega)\bm{G}^{0}(\bm{p},\omega) \\
\implies \bm{C}(\bm{p}, t) &= i \int \frac{\dd \omega}{2\pi} \frac{ \bm{\Sigma}^c(\bm{p},\omega+\epsilon_{\bm{p}}^{HF})}{(\omega + i \eta)^2} e^{-i \omega t} \\
&= i \int \frac{d\omega}{2\pi} \frac{1}{(\omega + i \eta)^2} e^{-i \omega t} \Biggl\{\sum_{\bm{q}}\sum_{\nu }^{\text{RPA}} \underbrace{\frac{4\pi}{|\bm{q}|^2} |\rho_\nu(\bm{q})|^2 }_{M_{\bm{q}\nu}^2}\left[ \frac{f_{\bm{p} - \bm{q}}}{\omega \underbrace{+ \Omega_\nu(\bm{q}) + (\epsilon_{\bm{p}} - \epsilon_{\bm{p} - \bm{q}}) + i\eta}_{-\Delta ^{\text{occ}}_{\bm{q}\nu}}}\right. \\
& \left. + \frac{1 - f_{\bm{p} - \bm{q}}}{\omega \underbrace{- \Omega_\nu(\bm{q})+ (\epsilon_{\bm{p}} - \epsilon_{\bm{p} - \bm{q}} )+ i\eta}_{-\Delta^{\text{virt}}_{\bm{q}\nu}}} \right]\Biggr\} \notag \\
&= i \sum_{\bm{q}\nu} M_{\bm{q}\nu}^2 \int \frac{d\omega}{2\pi} e^{-i \omega t} \left[\frac{f_{\bm{p} - \bm{q}}}{(\omega + i \eta)^2(\omega - \Delta^{\text{occ}}_{\bm{q}\nu})} + \frac{1 - f_{\bm{p} - \bm{q}}}{(\omega + i \eta)^2(\omega - \Delta^{\text{virt}}_{\bm{q}\nu})}\right] \\
&= \sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{occ}} \left[e^{-i \Delta^{\text{occ}}_{\bm{q}\nu} t} - 1 + i \Delta^{\text{occ}}_{\bm{q}\nu} t\right] + \sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{virt}} \left[e^{-i \Delta^{\text{virt}}_{\bm{q}\nu} t} - 1 + i \Delta^{\text{virt}}_{\bm{q}\nu} t\right]
\end{align}
For the final expression, we have defined $\zeta_{\bm{p}\bm{q}\nu}^{\text{occ}} = \left(\frac{f_{\bm{p}-\bm{q}} M_{\bm{q}\nu}}{\Delta^{\text{occ}}_{\bm{q}\nu}}\right)^2$ and $\zeta_{\bm{p}\bm{q}\nu}^{\text{virt}} = \left(\frac{(1-f_{\bm{p}-\bm{q}}) M_{\bm{q}\nu}}{\Delta^{\text{virt}}_{\bm{q}\nu}}\right)^2$. This allows us to arrive at the something similar to the Landau form of the cumulant.
%  For the final expression, we have defined $\zeta_{pi\nu} = \left(\frac{M_{pi\nu}}{\Delta_{pi\nu}}\right)^2$ and $\zeta_{pa\nu} = \left(\frac{M_{pa\nu}}{\Delta_{pa\nu}}\right)^2$. This allows us to arrive at the something similar to the Landau form of the cumulant.
\begin{tcolorbox}
A few notes on how to evaluate the contour integral: there is a double pole at $\omega_1 = -i\eta$ and a simple pole at $\omega_2 = -\Delta - i\eta$. Closing the contour in the lower half-plane because $\operatorname{Im}\left(\omega_1\right), \operatorname{Im}\left(\omega_2\right)<0$, and applying Cauchy's residue theorem, leads to
\begin{align}
    \int \frac{\mathrm{d} \omega}{2 \pi} e^{-\mathrm{i} \omega t} \frac{1}{\left(\omega-\omega_1\right)^2} \frac{1}{\omega-\omega_2} & =(-\mathrm{i})\left\{\left[\partial_\omega\left(\frac{e^{-\mathrm{i} \omega t}}{\omega-\omega_2}\right)\right]_{\omega=\omega_1}+\left[\frac{e^{-\mathrm{i} \omega t}}{\left(\omega-\omega_1\right)^2}\right]_{\omega=\omega_2}\right\} \\
    & =\frac{(-\mathrm{i})}{\left(\omega_1-\omega_2\right)^2}\left\{\left[(-\mathrm{i} t)\left(\omega_1-\omega_2\right)-1\right] e^{-\mathrm{i} \omega_1 t}+e^{-\mathrm{i} \omega_2 t}\right\}\\
\implies \int \frac{\mathrm{d} \omega}{2 \pi} e^{-i \omega t} \frac{1}{[\omega-(0-\mathrm{i} \eta)]^2} \frac{f}{\omega-\Delta}&=\frac{-\mathrm{i}f}{\Delta^2}\left(e^{-\mathrm{i} \Delta t}+\mathrm{i} \Delta t-1\right)
\end{align}
\end{tcolorbox}
\subsection{Green's function}
Now, we plug in our derived expression for $C(\bm{p}, t)$ into the cumulant ansatz for the retarded Green's function:
\begin{align}
G^{GW+C}(\bm{p}, t) & = G^{HF}(\bm{p}, t) e^{C(\bm{p}, t)} \\
& = -i \Theta(t) e^{-i \epsilon_{\bm{p}}^{HF} t + C(\bm{p}, t)} \\
& = -i \Theta(t) e^{-i \epsilon_{\bm{p}}^{HF} t + \sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{occ}}\left(e^{-i\Delta^{\text{occ}}_{\bm{q}\nu} t} + i\Delta^{\text{occ}}_{\bm{q}\nu} t - 1\right) + \sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{virt}} \left(e^{-i\Delta^{\text{virt}}_{\bm{q}\nu} t} + i\Delta^{\text{virt}}_{\bm{q}\nu} t - 1\right)}\\
&= -i \Theta (t) Z_{\bm{p}}^{QP} e^{-i \epsilon_{\bm{p}}^{QP} t} e^{\sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{occ}} e^{-i\Delta^{\text{occ}}_{\bm{q}\nu} t} + \sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{virt}} e^{-i\Delta^{\text{virt}}_{\bm{q}\nu} t}} \\
\end{align}
where we have the weight of the quasiparticle peak $Z_{\bm{p}}^{QP} = \exp\left(-\sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{occ}} - \sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{virt}}\right)$ and the quasiparticle energy $\epsilon_{\bm{p}}^{QP} = \epsilon_{\bm{p}}^{HF} - \left(\sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{occ}}\Delta^{\text{occ}}_{\bm{q}\nu} + \sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{virt}}\Delta^{\text{virt}}_{\bm{q}\nu}\right)$.
\begin{tcolorbox}
We pause to make some important connections. Notice
\begin{align}
    Z_{\bm{p}}^{QP} & = \exp\left(-\sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{occ}} - \sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{virt}}\right) \\
    & = \exp\left(-\sum_{\bm{q}\nu} \left(\frac{f_{\bm{p}-\bm{q}} M_{\bm{q}\nu}}{\Delta^{\text{occ}}_{\bm{q}\nu}}\right)^2 - \sum_{\bm{q}\nu} \left(\frac{(1-f_{\bm{p}-\bm{q}}) M_{\bm{q}\nu}}{\Delta^{\text{virt}}_{\bm{q}\nu}}\right)^2\right) \\
    & = \exp\left(\left[\frac{\partial \Sigma^c(\bm{p},\omega)}{\partial \omega}\right]_{\omega = \epsilon_{\bm{p}}^{HF}}\right)
\end{align}
and
\begin{align}
    \epsilon_{\bm{p}}^{QP} & = \epsilon_{\bm{p}}^{HF} - \left(\sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{occ}}\Delta^{\text{occ}}_{\bm{q}\nu} + \sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{virt}}\Delta^{\text{virt}}_{\bm{q}\nu}\right) \\
    & = \epsilon_{\bm{p}}^{HF} - \left(\sum_{\bm{q}\nu} \frac{f_{\bm{p}-\bm{q}} M_{\bm{q}\nu}^2}{\Delta^{\text{occ}}_{\bm{q}\nu}} + \sum_{\bm{q}\nu} \frac{(1-f_{\bm{p}-\bm{q}}) M_{\bm{q}\nu}^2}{\Delta^{\text{virt}}_{\bm{q}\nu}}\right) \\
    & = \epsilon_{\bm{p}}^{HF} + \Sigma^c(\bm{p},\epsilon_{\bm{p}}^{HF})
\end{align}
where we have used the fact that $\Sigma^c(\bm{p},\omega) = \sum_{\bm{q}\nu} \frac{f_{\bm{p}-\bm{q}} M_{\bm{q}\nu}^2}{\omega + \Omega_\nu(\bm{q}) - \epsilon_{\bm{p}-\bm{q}}} + \sum_{\bm{q}\nu} \frac{(1-f_{\bm{p}-\bm{q}}) M_{\bm{q}\nu}^2}{\omega - \Omega_\nu(\bm{q}) - \epsilon_{\bm{p}-\bm{q}}} \implies \left[\frac{\partial \Sigma^c(\bm{p},\omega)}{\partial \omega}\right]_{\omega = \epsilon_{\bm{p}}^{HF}} = -\sum_{\bm{q}\nu} \left(\frac{f_{\bm{p}-\bm{q}} M_{\bm{q}\nu}}{\Delta^{\text{occ}}_{\bm{q}\nu}}\right)^2 - \sum_{\bm{q}\nu} \left(\frac{(1-f_{\bm{p}-\bm{q}}) M_{\bm{q}\nu}}{\Delta^{\text{virt}}_{\bm{q}\nu}}\right)^2$.
\end{tcolorbox}
Next, we want to perform a Fourier transform.
\begin{align}
G^{GW+C}(\bm{p}, \omega) & = \int_{-\infty}^{\infty} dt\, e^{i \omega t} G^{GW+C}(\bm{p}, t) \\
& = -i Z_{\bm{p}}^{QP} \int_0^{\infty} dt\, e^{i(\omega - \epsilon_{\bm{p}}^{QP}) t} e^{\sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{occ}} e^{-i\Delta^{\text{occ}}_{\bm{q}\nu} t} + \sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{virt}} e^{-i\Delta^{\text{virt}}_{\bm{q}\nu} t}} \\
& = -i Z_{\bm{p}}^{QP} \int_0^{\infty} dt\, e^{i(\omega - \epsilon_{\bm{p}}^{QP}) t} \left(1 + \sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{occ}} e^{-i\Delta^{\text{occ}}_{\bm{q}\nu} t} + \sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{virt}} e^{-i\Delta^{\text{virt}}_{\bm{q}\nu} t} + \ldots \right) \\
&= -i Z_{\bm{p}}^{QP} \int_0^{\infty} dt\, e^{[-\eta + i(\omega - \epsilon_{\bm{p}}^{QP}) t]}\label{Gpp3} \\
&\quad - i Z_{\bm{p}}^{QP} \sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{occ}} \int_0^{\infty} dt\, e^{[-\eta + i(\omega - \epsilon_{\bm{p}}^{QP} - \Delta^{\text{occ}}_{\bm{q}\nu}) t]} \notag \\
&\quad - i Z_{\bm{p}}^{QP} \sum_{\bm{q}\nu} \zeta_{\bm{p}\bm{q}\nu}^{\text{virt}} \int_0^{\infty} dt\, e^{[-\eta + i(\omega - \epsilon_{\bm{p}}^{QP} - \Delta^{\text{virt}}_{\bm{q}\nu}) t]} + \ldots \notag \\
&= \frac{Z_{\bm{p}}^{QP}}{\omega - \epsilon_{\bm{p}}^{QP} + i\eta} + \sum_{\bm{q}\nu} \frac{Z_{\bm{p}}^{QP} \zeta_{\bm{p}\bm{q}\nu}^{\text{occ}}}{\omega - \epsilon_{\bm{p}}^{QP} - \Delta^{\text{occ}}_{\bm{q}\nu} + i\eta} + \sum_{\bm{q}\nu} \frac{Z_{\bm{p}}^{QP} \zeta_{\bm{p}\bm{q}\nu}^{\text{virt}}}{\omega - \epsilon_{\bm{p}}^{QP} - \Delta^{\text{virt}}_{\bm{q}\nu} + i\eta} + \ldots\\
& = \frac{Z_{\bm{p}}^{QP}}{\omega - \epsilon_{\bm{p}}^{QP} + i\eta} + \sum_{\bm{q}\nu} \frac{Z_{\bm{p}\bm{q}\nu}^{\text{occ-sat}}}{\omega - \epsilon_{\bm{p}\bm{q}\nu}^{\text{occ-sat}} + i\eta} + \sum_{\bm{q}\nu} \frac{Z_{\bm{p}\bm{q}\nu}^{\text{virt-sat}}}{\omega - \epsilon_{\bm{p}\bm{q}\nu}^{\text{virt-sat}} + i\eta} + \ldots
\end{align}
where we define the satellite energies $\epsilon_{\bm{p}\bm{q}\nu}^{\text{occ-sat}} = \epsilon_{\bm{p}}^{QP} + \Delta^{\text{occ}}_{\bm{q}\nu}$ and $\epsilon_{\bm{p}\bm{q}\nu}^{\text{virt-sat}} = \epsilon_{\bm{p}}^{QP} + \Delta^{\text{virt}}_{\bm{q}\nu}$, as well as the satellite weights $Z_{\bm{p}\bm{q}\nu}^{\text{occ-sat}} = Z_{\bm{p}}^{QP} \zeta_{\bm{p}\bm{q}\nu}^{\text{occ}}$ and $Z_{\bm{p}\bm{q}\nu}^{\text{virt-sat}} = Z_{\bm{p}}^{QP} \zeta_{\bm{p}\bm{q}\nu}^{\text{virt}}$.
\subsection{Spectral function}
The spectral function is obtained as (the virtual satellites spectral function, whose derivation will mirror that of the occupied satellites, are omitted for the sake of brevity)
\begin{align}
A^{GW+C}(\bm{p}, \omega) & = -\frac{1}{\pi} \operatorname{Im} G^{GW+C}(\bm{p}, \omega) \\
& = -\frac{1}{\pi} \operatorname{Im}\left[\frac{Z_{\bm{p}}^{QP}}{\omega - \epsilon_{\bm{p}}^{QP} + i\eta} + \sum_{\bm{q}\nu} \frac{Z_{\bm{p}\bm{q}\nu}^{\text{occ-sat}}}{\omega - \epsilon_{\bm{p}\bm{q}\nu}^{\text{occ-sat}} + i\eta} + \ldots \right] \\
& = -\frac{1}{\pi} \operatorname{Im}\left[\frac{\operatorname{Re} Z_{\bm{p}}^{QP} + i \operatorname{Im} Z_{\bm{p}}^{QP}}{\omega - \operatorname{Re} \epsilon_{\bm{p}}^{QP} + i\left(\eta - \operatorname{Im} \epsilon_{\bm{p}}^{QP}\right)} + \sum_{\bm{q}\nu} \frac{\operatorname{Re} Z_{\bm{p}\bm{q}\nu}^{\text{occ-sat}} + i \operatorname{Im} Z_{\bm{p}\bm{q}\nu}^{\text{occ-sat}}}{\omega - \operatorname{Re} \epsilon_{\bm{p}\bm{q}\nu}^{\text{occ-sat}} + i\left(\eta - \operatorname{Im} \epsilon_{\bm{p}\bm{q}\nu}^{\text{occ-sat}}\right)} + \ldots \right] \\
& = -\frac{1}{\pi} \operatorname{Im}\left[\frac{\left(\operatorname{Re} Z_{\bm{p}}^{QP} + i \operatorname{Im} Z_{\bm{p}}^{QP}\right)\left(\omega - \operatorname{Re} \epsilon_{\bm{p}}^{QP} - i\left(\eta - \operatorname{Im} \epsilon_{\bm{p}}^{QP}\right)\right)}{\left(\omega - \operatorname{Re} \epsilon_{\bm{p}}^{QP}\right)^2 + \left(\operatorname{Im} \epsilon_{\bm{p}}^{QP}\right)^2}\right.\\
& \left. + \sum_{\bm{q}\nu} \frac{\left(\operatorname{Re} Z_{\bm{p}\bm{q}\nu}^{\text{occ-sat}} + i \operatorname{Im} Z_{\bm{p}\bm{q}\nu}^{\text{occ-sat}}\right)\left(\omega - \operatorname{Re} \epsilon_{\bm{p}\bm{q}\nu}^{\text{occ-sat}} - i\left(\eta - \operatorname{Im} \epsilon_{\bm{p}\bm{q}\nu}^{\text{occ-sat}}\right)\right)}{\left(\omega - \operatorname{Re} \epsilon_{\bm{p}\bm{q}\nu}^{\text{occ-sat}}\right)^2 + \left(\operatorname{Im} \epsilon_{\bm{p}\bm{q}\nu}^{\text{occ-sat}}\right)^2} + \ldots \right] \\
& = -\frac{1}{\pi}\left[\frac{\left(\operatorname{Re} Z_{\bm{p}}^{QP}\right)\left(\operatorname{Im} \epsilon_{\bm{p}}^{QP}\right) + \left(\operatorname{Im} Z_{\bm{p}}^{QP}\right)\left(\omega - \operatorname{Re} \epsilon_{\bm{p}}^{QP}\right)}{\left(\omega - \operatorname{Re} \epsilon_{\bm{p}}^{QP}\right)^2 + \left(\operatorname{Im} \epsilon_{\bm{p}}^{QP}\right)^2}\right.\\
& \left. + \sum_{\bm{q}\nu} \frac{\left(\operatorname{Re} Z_{\bm{p}\bm{q}\nu}^{\text{occ-sat}}\right)\left(\operatorname{Im} \epsilon_{\bm{p}\bm{q}\nu}^{\text{occ-sat}}\right) + \left(\operatorname{Im} Z_{\bm{p}\bm{q}\nu}^{\text{occ-sat}}\right)\left(\omega - \operatorname{Re} \epsilon_{\bm{p}\bm{q}\nu}^{\text{occ-sat}}\right)}{\left(\omega - \operatorname{Re} \epsilon_{\bm{p}\bm{q}\nu}^{\text{occ-sat}}\right)^2 + \left(\operatorname{Im} \epsilon_{\bm{p}\bm{q}\nu}^{\text{occ-sat}}\right)^2} + \ldots \right]
\end{align}
